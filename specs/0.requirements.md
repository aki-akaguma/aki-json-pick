# Requirements for aki-json-pick

## 1. Core Functionality

- The application shall be a command-line interface (CLI) tool named `aki-json-pick`.
- It shall read a JSON formatted string from standard input.
- It shall parse the input string as JSON.
- It shall select a portion of the parsed JSON data based on a user-provided selector query.
- It shall write the selected JSON portion to standard output.
- It shall handle JSON data streams and apply selections accordingly.

## 2. Command-Line Interface (CLI)

### 2.1. Options and Arguments

The CLI shall accept the following options:

-   **Selector:**
    -   `-s <selector>` or `--select <selector>`
    -   Specifies the query to select parts of the JSON data.
    -   The selector syntax shall be compatible with the `jql` crate.
    -   If not provided, the default selector shall be `.` (selects the entire input JSON).

-   **Output Formatting:**
    -   `-p` or `--pretty`: If present, the output JSON shall be pretty-printed for human readability.
    -   `-r` or `--raw-output`: If the selected value is a JSON string, this option shall print the raw string content without the surrounding double quotes.
    -   `--color <when>`: Controls colored output for the JSON.
        -   `<when>` must be one of `always`, `never`, or `auto`.
        -   `auto` is the default and should enable color only when the output is a TTY.

-   **Standard Options:**
    -   `-H` or `--help`: Display a help message detailing usage, options, and examples, and then exit.
    -   `-V` or `--version`: Display the application's version information and then exit.
    -   `-X <x-options>`: An extensible set of options for less common use cases. It should have its own help (`-X help`).

### 2.2. Input and Output

-   **Standard Input (`stdin`):** The primary source for the JSON data to be processed.
-   **Standard Output (`stdout`):** The destination for the selected JSON data. A newline character shall be appended to the output.
-   **Standard Error (`stderr`):** The destination for all error messages.

## 3. Error Handling

The application shall gracefully handle and report the following error conditions:

-   **Invalid Input:** The data from `stdin` is not valid JSON.
-   **Invalid Selector:** The selector string provided via the `-s` or `--select` option is syntactically incorrect.
-   **Selection Failure:** The selector does not match any part of the input JSON.
-   **Invalid Options:** The user provides an unknown command-line option or an invalid value for an option (e.g., `--color foo`).

## 4. Non-Functional Requirements

-   **Platform:** Shall be a cross-platform tool, runnable on Linux, macOS, and Windows.
-   **Dependencies:** The core selection logic will rely on the `jql` Rust crate. JSON serialization will use `serde_json`.
-   **Performance:** The tool should be efficient for typical JSON file sizes and stream processing.
-   **Documentation:**
    -   A `README.md` file must provide a clear description, features, and usage examples.
    -   The in-app help message must be comprehensive.
